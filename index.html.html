<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpayWeather - Prévisions météo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif;
        }

        body {
            overflow: hidden;
            height: 100vh;
            position: relative;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }

        #video-bg {
            position: fixed;
            right: 0;
            bottom: 0;
            min-width: 100%;
            min-height: 100%;
            z-index: -1;
            object-fit: cover;
            opacity: 0.4;
            transition: opacity 1s ease;
        }

        .app-container {
            position: relative;
            z-index: 1;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: rgba(0, 0, 0, 0.4);
            color: white;
            backdrop-filter: blur(8px);
            transition: all 0.5s ease;
        }

        .header {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.3);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .search-container {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        #city-input {
            padding: 12px 20px;
            border: none;
            border-radius: 30px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 16px;
            outline: none;
            width: 200px;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            backdrop-filter: blur(5px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        #city-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        #city-input:focus {
            background: rgba(255, 255, 255, 0.25);
            width: 250px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        #search-btn {
            width: 48px;
            height: 48px;
            border: none;
            border-radius: 50%;
            background: rgba(76, 201, 240, 0.7);
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(76, 201, 240, 0.3);
        }

        #search-btn:hover {
            background: rgba(76, 201, 240, 0.9);
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 6px 20px rgba(76, 201, 240, 0.4);
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            text-align: center;
            overflow-y: auto;
        }

        .current-weather {
            margin-bottom: 20px;
            width: 100%;
            animation: fadeIn 0.8s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #city-name {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            letter-spacing: 0.5px;
        }

        .weather-main {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
        }

        #weather-icon {
            font-size: 80px;
            text-shadow: 0 2px 15px rgba(0, 0, 0, 0.5);
            animation: pulse 2s infinite alternate;
        }

        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        #temp {
            font-size: 72px;
            font-weight: 300;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            background: linear-gradient(45deg, #fff, #4cc9f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            position: relative;
        }

        #weather-desc {
            font-size: 24px;
            margin-bottom: 15px;
            text-transform: capitalize;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
            font-weight: 500;
        }

        .weather-details {
            display: flex;
            gap: 20px;
            margin-top: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .detail {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            min-width: 100px;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .detail:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .detail i {
            font-size: 24px;
            margin-bottom: 5px;
            color: #4cc9f0;
        }

        .detail span {
            display: block;
            font-size: 18px;
        }

        .forecast-container {
            width: 100%;
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: slideUp 0.8s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .forecast-title {
            font-size: 20px;
            margin-bottom: 15px;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #4cc9f0;
        }

        .forecast-title i {
            color: #4cc9f0;
        }

        .hourly-forecast {
            display: flex;
            gap: 10px;
            overflow-x: auto;
            padding: 15px 0;
            scrollbar-width: none;
            margin-bottom: 20px;
        }

        .hourly-forecast::-webkit-scrollbar {
            display: none;
        }

        .hour-item {
            min-width: 60px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .hour-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }

        .hour-time {
            font-weight: 500;
            margin-bottom: 5px;
            font-size: 14px;
        }

        .hour-icon {
            font-size: 20px;
            margin: 5px 0;
            color: #ffd700;
        }

        .hour-temp {
            font-weight: 600;
            font-size: 16px;
        }

        /* Style pour les prévisions sur 5 jours */
        .daily-forecast {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            gap: 10px;
        }

        .day-item {
            flex: 1;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            min-width: 0;
            cursor: pointer;
        }

        .day-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-5px);
        }

        .day-name {
            font-weight: 600;
            margin-bottom: 10px;
            font-size: 16px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
            text-align: center;
        }

        .day-date {
            font-size: 14px;
            margin-bottom: 10px;
            color: rgba(255, 255, 255, 0.8);
        }

        .day-icon {
            font-size: 30px;
            margin: 10px 0;
            color: #ffd700;
        }

        .day-temp {
            font-weight: 600;
            font-size: 18px;
        }

        .sun-info {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            text-align: left;
            animation: fadeIn 0.5s ease;
        }

        .sun-info.active {
            display: block;
        }

        .uv-info {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            text-align: left;
            animation: fadeIn 0.5s ease;
        }

        .uv-info.active {
            display: block;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .tab-container {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.7);
        }

        .tab.active {
            border-bottom: 3px solid #4cc9f0;
            color: #4cc9f0;
            background: rgba(76, 201, 240, 0.1);
        }

        .tab:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .music-control {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 10;
        }

        .music-control:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .music-control i {
            font-size: 20px;
            color: white;
        }

        .location-info {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 25px;
            font-size: 14px;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .location-info:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px);
        }

        .location-info i {
            color: #4cc9f0;
        }

        .lang-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 12px;
            border-radius: 25px;
            font-size: 14px;
            backdrop-filter: blur(5px);
            z-index: 10;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .lang-selector:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        #language-select {
            background: transparent;
            border: none;
            color: white;
            outline: none;
            cursor: pointer;
        }

        #language-select option {
            background: rgba(0, 0, 0, 0.8);
            color: white;
        }

        /* Style pour l'indice UV */
        .uv-index {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            gap: 15px;
        }

        .uv-value {
            font-size: 36px;
            font-weight: 700;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }

        .uv-low {
            background: linear-gradient(135deg, #2ecc71, #27ae60);
        }

        .uv-moderate {
            background: linear-gradient(135deg, #f1c40f, #f39c12);
        }

        .uv-high {
            background: linear-gradient(135deg, #e67e22, #d35400);
        }

        .uv-very-high {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .uv-extreme {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
        }

        .uv-label {
            font-size: 18px;
            font-weight: 600;
        }

        /* Effets visuels supplémentaires */
        .glow {
            text-shadow: 0 0 10px rgba(76, 201, 240, 0.7);
        }

        .floating {
            animation: floating 3s ease-in-out infinite;
        }

        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        @media (max-width: 600px) {
            #city-name {
                font-size: 26px;
            }

            #temp {
                font-size: 60px;
            }

            .hour-item {
                min-width: 50px;
                padding: 8px 5px;
            }

            .day-item {
                padding: 10px 5px;
            }

            .day-name {
                font-size: 14px;
            }

            .day-icon {
                font-size: 24px;
            }

            .day-temp {
                font-size: 16px;
            }

            .header {
                flex-direction: column;
                gap: 15px;
            }

            .lang-selector {
                top: 10px;
                right: 10px;
            }

            .tab {
                padding: 8px 12px;
                font-size: 14px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Fond vidéo animé -->
    <video autoplay muted loop id="video-bg">
        <source src="Live Wallpaper Anime HD4K - Samurai Autumn.mp4" type="video/mp4">
    </video>

    <!-- Musique d'ambiance -->
    <audio autoplay loop id="bg-music">
        <source src="AURA of GLORY (Super Slowed).mp3" type="audio/mpeg">
    </audio>

    <!-- Contrôle musique -->
    <div class="music-control" id="music-toggle">
        <i class="fas fa-music"></i>
    </div>

    <!-- Sélecteur de langue -->
    <div class="lang-selector">
        <select id="language-select">
            <option value="fr">Français</option>
            <option value="en">English</option>
            <option value="es">Español</option>
            <option value="de">Deutsch</option>
            <option value="it">Italiano</option>
            <option value="pt">Português</option>
            <option value="ru">Русский</option>
            <option value="zh">中文</option>
            <option value="ja">日本語</option>
            <option value="ar">العربية</option>
        </select>
    </div>

    <!-- Application météo -->
    <div class="app-container">
        <header class="header">
            <h1 id="app-title">SpayWeather</h1>
            <div class="search-container">
                <input type="text" id="city-input" placeholder="Rechercher une ville...">
                <button id="search-btn"><i class="fas fa-search"></i></button>
            </div>
        </header>

        <main class="main-content">
            <div class="current-weather">
                <h2 id="city-name">Chargement...</h2>
                <div class="weather-main">
                    <div id="weather-icon"><i class="fas fa-sun"></i></div>
                    <div><span id="temp">--</span>°</div>
                </div>
                <p id="weather-desc">--</p>

                <div class="weather-details">
                    <div class="detail">
                        <i class="fas fa-tint"></i>
                        <span id="humidity">--%</span>
                    </div>
                    <div class="detail">
                        <i class="fas fa-sun"></i>
                        <span id="uv-index">--</span>
                    </div>
                    <div class="detail">
                        <i class="fas fa-temperature-low"></i>
                        <span id="feels-like">--°C</span>
                    </div>
                    <div class="detail">
                        <i class="fas fa-eye"></i>
                        <span id="visibility">-- km</span>
                    </div>
                </div>
            </div>

            <!-- Prévisions -->
            <div class="forecast-container">
                <div class="tab-container">
                    <div class="tab active" id="hourly-tab"><i class="fas fa-clock"></i> Prévisions</div>
                    <div class="tab" id="daily-tab"><i class="fas fa-calendar-day"></i> 5 jours</div>
                    <div class="tab" id="sun-tab"><i class="fas fa-sun"></i> Soleil</div>
                    <div class="tab" id="uv-tab"><i class="fas fa-sun"></i> UV</div>
                </div>

                <div id="hourly-content">
                    <!-- Prévisions horaires -->
                    <div class="hourly-forecast" id="hourly-forecast">
                        <!-- Rempli par JavaScript avec les heures spécifiques -->
                    </div>
                </div>

                <!-- Prévisions sur 5 jours -->
                <div class="daily-forecast" id="daily-forecast">
                    <!-- Rempli par JavaScript avec les jours -->
                </div>

                <!-- Info soleil -->
                <div class="sun-info" id="sun-info">
                    <div class="detail-row">
                        <span><i class="fas fa-sunrise"></i> Lever du soleil</span>
                        <span id="sunrise-value">--:--</span>
                    </div>
                    <div class="detail-row">
                        <span><i class="fas fa-sunset"></i> Coucher du soleil</span>
                        <span id="sunset-value">--:--</span>
                    </div>
                    <div class="detail-row">
                        <span><i class="fas fa-clock"></i> Durée du jour</span>
                        <span id="daylight-value">--h --m</span>
                    </div>
                    <div class="detail-row">
                        <span><i class="fas fa-moon"></i> Phase lunaire</span>
                        <span id="moon-phase">--</span>
                    </div>
                </div>

                <!-- Info UV -->
                <div class="uv-info" id="uv-info">
                    <div class="uv-index">
                        <div class="uv-value uv-low" id="uv-value">--</div>
                        <div class="uv-label" id="uv-label">--</div>
                    </div>
                    <div class="detail-row">
                        <span>0-2</span>
                        <span>Faible</span>
                    </div>
                    <div class="detail-row">
                        <span>3-5</span>
                        <span>Modéré</span>
                    </div>
                    <div class="detail-row">
                        <span>6-7</span>
                        <span>Élevé</span>
                    </div>
                    <div class="detail-row">
                        <span>8-10</span>
                        <span>Très élevé</span>
                    </div>
                    <div class="detail-row">
                        <span>11+</span>
                        <span>Extrême</span>
                    </div>
                </div>
            </div>
        </main>

        <!-- Info de localisation -->
        <div class="location-info" id="location-info">
            <i class="fas fa-map-marker-alt"></i>
            <span id="location-text">Localisation en cours...</span>
        </div>
    </div>

    <script>
        // Configuration API
        const WEATHER_API_KEY = 'eb29384628c0ba8611b8df0ef02a7377';

        // Éléments du DOM
        const elements = {
            cityInput: document.getElementById('city-input'),
            searchBtn: document.getElementById('search-btn'),
            cityName: document.getElementById('city-name'),
            weatherIcon: document.getElementById('weather-icon'),
            temp: document.getElementById('temp'),
            weatherDesc: document.getElementById('weather-desc'),
            humidity: document.getElementById('humidity'),
            uvIndex: document.getElementById('uv-index'),
            feelsLike: document.getElementById('feels-like'),
            visibility: document.getElementById('visibility'),
            musicToggle: document.getElementById('music-toggle'),
            bgMusic: document.getElementById('bg-music'),
            videoBg: document.getElementById('video-bg'),
            hourlyForecast: document.getElementById('hourly-forecast'),
            dailyForecast: document.getElementById('daily-forecast'),
            locationInfo: document.getElementById('location-info'),
            locationText: document.getElementById('location-text'),
            languageSelect: document.getElementById('language-select'),
            appTitle: document.getElementById('app-title'),
            hourlyTab: document.getElementById('hourly-tab'),
            dailyTab: document.getElementById('daily-tab'),
            sunTab: document.getElementById('sun-tab'),
            uvTab: document.getElementById('uv-tab'),
            hourlyContent: document.getElementById('hourly-content'),
            sunInfo: document.getElementById('sun-info'),
            uvInfo: document.getElementById('uv-info'),
            sunriseValue: document.getElementById('sunrise-value'),
            sunsetValue: document.getElementById('sunset-value'),
            daylightValue: document.getElementById('daylight-value'),
            moonPhase: document.getElementById('moon-phase'),
            uvValue: document.getElementById('uv-value'),
            uvLabel: document.getElementById('uv-label')
        };

        // Icônes météo
        const weatherIcons = {
            '01d': 'fa-sun',           // ciel clair (jour)
            '01n': 'fa-moon',          // ciel clair (nuit)
            '02d': 'fa-cloud-sun',     // quelques nuages (jour)
            '02n': 'fa-cloud-moon',    // quelques nuages (nuit)
            '03d': 'fa-cloud',         // nuages dispersés
            '03n': 'fa-cloud',
            '04d': 'fa-cloud',         // nuages brisés
            '04n': 'fa-cloud',
            '09d': 'fa-cloud-rain',    // pluie légère
            '09n': 'fa-cloud-rain',
            '10d': 'fa-cloud-showers-heavy', // pluie
            '10n': 'fa-cloud-showers-heavy',
            '11d': 'fa-bolt',         // orage
            '11n': 'fa-bolt',
            '13d': 'fa-snowflake',    // neige
            '13n': 'fa-snowflake',
            '50d': 'fa-smog',         // brouillard
            '50n': 'fa-smog'
        };

        // Phases lunaires
        const moonPhases = {
            0: 'Nouvelle lune',
            1: 'Premier croissant',
            2: 'Premier quartier',
            3: 'Lune gibbeuse croissante',
            4: 'Pleine lune',
            5: 'Lune gibbeuse décroissante',
            6: 'Dernier quartier',
            7: 'Dernier croissant'
        };

        // Jours de la semaine
        const weekDays = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];

        // Traductions
        const translations = {
            fr: {
                appTitle: "SpayWeather",
                searchPlaceholder: "Rechercher une ville...",
                loading: "Chargement...",
                hourlyTab: "Prévisions",
                dailyTab: "5 jours",
                sunTab: "Soleil",
                uvTab: "UV",
                sunrise: "Lever du soleil",
                sunset: "Coucher du soleil",
                daylight: "Durée du jour",
                moonPhase: "Phase lunaire",
                locationText: "Localisation en cours...",
                locationFound: "Vous êtes à {city}",
                locationError: "Localisation non disponible",
                uvLabels: {
                    low: "Faible",
                    moderate: "Modéré",
                    high: "Élevé",
                    veryHigh: "Très élevé",
                    extreme: "Extrême"
                },
                uvGuide: {
                    "0-2": "Faible",
                    "3-5": "Modéré",
                    "6-7": "Élevé",
                    "8-10": "Très élevé",
                    "11+": "Extrême"
                }
            },
            en: {
                appTitle: "SpayWeather",
                searchPlaceholder: "Search for a city...",
                loading: "Loading...",
                hourlyTab: "Forecast",
                dailyTab: "5 days",
                sunTab: "Sun",
                uvTab: "UV",
                sunrise: "Sunrise",
                sunset: "Sunset",
                daylight: "Daylight",
                moonPhase: "Moon phase",
                locationText: "Locating...",
                locationFound: "You are in {city}",
                locationError: "Location not available",
                uvLabels: {
                    low: "Low",
                    moderate: "Moderate",
                    high: "High",
                    veryHigh: "Very High",
                    extreme: "Extreme"
                },
                uvGuide: {
                    "0-2": "Low",
                    "3-5": "Moderate",
                    "6-7": "High",
                    "8-10": "Very High",
                    "11+": "Extreme"
                }
            },
            es: {
                appTitle: "SpayWeather",
                searchPlaceholder: "Buscar una ciudad...",
                loading: "Cargando...",
                hourlyTab: "Pronóstico",
                dailyTab: "5 días",
                sunTab: "Sol",
                uvTab: "UV",
                sunrise: "Amanecer",
                sunset: "Atardecer",
                daylight: "Duración del día",
                moonPhase: "Fase lunar",
                locationText: "Localizando...",
                locationFound: "Estás en {city}",
                locationError: "Ubicación no disponible",
                uvLabels: {
                    low: "Bajo",
                    moderate: "Moderado",
                    high: "Alto",
                    veryHigh: "Muy Alto",
                    extreme: "Extremo"
                },
                uvGuide: {
                    "0-2": "Bajo",
                    "3-5": "Moderado",
                    "6-7": "Alto",
                    "8-10": "Muy Alto",
                    "11+": "Extremo"
                }
            },
            de: {
                appTitle: "SpayWeather",
                searchPlaceholder: "Suche nach einer Stadt...",
                loading: "Laden...",
                hourlyTab: "Vorhersage",
                dailyTab: "5 Tage",
                sunTab: "Sonne",
                uvTab: "UV",
                sunrise: "Sonnenaufgang",
                sunset: "Sonnenuntergang",
                daylight: "Tageslicht",
                moonPhase: "Mondphase",
                locationText: "Ortung...",
                locationFound: "Sie sind in {city}",
                locationError: "Standort nicht verfügbar",
                uvLabels: {
                    low: "Niedrig",
                    moderate: "Mäßig",
                    high: "Hoch",
                    veryHigh: "Sehr hoch",
                    extreme: "Extrem"
                },
                uvGuide: {
                    "0-2": "Niedrig",
                    "3-5": "Mäßig",
                    "6-7": "Hoch",
                    "8-10": "Sehr hoch",
                    "11+": "Extrem"
                }
            },
            it: {
                appTitle: "SpayWeather",
                searchPlaceholder: "Cerca una città...",
                loading: "Caricamento...",
                hourlyTab: "Previsioni",
                dailyTab: "5 giorni",
                sunTab: "Sole",
                uvTab: "UV",
                sunrise: "Alba",
                sunset: "Tramonto",
                daylight: "Luce del giorno",
                moonPhase: "Fase lunare",
                locationText: "Localizzazione...",
                locationFound: "Sei a {city}",
                locationError: "Posizione non disponibile",
                uvLabels: {
                    low: "Basso",
                    moderate: "Moderato",
                    high: "Alto",
                    veryHigh: "Molto alto",
                    extreme: "Estremo"
                },
                uvGuide: {
                    "0-2": "Basso",
                    "3-5": "Moderato",
                    "6-7": "Alto",
                    "8-10": "Molto alto",
                    "11+": "Estremo"
                }
            },
            pt: {
                appTitle: "SpayWeather",
                searchPlaceholder: "Pesquisar por uma cidade...",
                loading: "Carregando...",
                hourlyTab: "Previsão",
                dailyTab: "5 dias",
                sunTab: "Sol",
                uvTab: "UV",
                sunrise: "Nascer do sol",
                sunset: "Pôr do sol",
                daylight: "Duração do dia",
                moonPhase: "Fase lunar",
                locationText: "Localizando...",
                locationFound: "Você está em {city}",
                locationError: "Localização não disponível",
                uvLabels: {
                    low: "Baixo",
                    moderate: "Moderado",
                    high: "Alto",
                    veryHigh: "Muito alto",
                    extreme: "Extremo"
                },
                uvGuide: {
                    "0-2": "Baixo",
                    "3-5": "Moderado",
                    "6-7": "Alto",
                    "8-10": "Muito alto",
                    "11+": "Extremo"
                }
            },
            ru: {
                appTitle: "SpayWeather",
                searchPlaceholder: "Поиск города...",
                loading: "Загрузка...",
                hourlyTab: "Прогноз",
                dailyTab: "5 дней",
                sunTab: "Солнце",
                uvTab: "УФ",
                sunrise: "Восход",
                sunset: "Закат",
                daylight: "Продолжительность дня",
                moonPhase: "Фаза луны",
                locationText: "Определение местоположения...",
                locationFound: "Вы в {city}",
                locationError: "Местоположение недоступно",
                uvLabels: {
                    low: "Низкий",
                    moderate: "Умеренный",
                    high: "Высокий",
                    veryHigh: "Очень высокий",
                    extreme: "Экстремальный"
                },
                uvGuide: {
                    "0-2": "Низкий",
                    "3-5": "Умеренный",
                    "6-7": "Высокий",
                    "8-10": "Очень высокий",
                    "11+": "Экстремальный"
                }
            },
            zh: {
                appTitle: "SpayWeather",
                searchPlaceholder: "搜索城市...",
                loading: "加载中...",
                hourlyTab: "预报",
                dailyTab: "5天",
                sunTab: "太阳",
                uvTab: "紫外线",
                sunrise: "日出",
                sunset: "日落",
                daylight: "日照时间",
                moonPhase: "月相",
                locationText: "定位中...",
                locationFound: "您在{city}",
                locationError: "位置不可用",
                uvLabels: {
                    low: "低",
                    moderate: "中等",
                    high: "高",
                    veryHigh: "很高",
                    extreme: "极高"
                },
                uvGuide: {
                    "0-2": "低",
                    "3-5": "中等",
                    "6-7": "高",
                    "8-10": "很高",
                    "11+": "极高"
                }
            },
            ja: {
                appTitle: "SpayWeather",
                searchPlaceholder: "都市を検索...",
                loading: "読み込み中...",
                hourlyTab: "予報",
                dailyTab: "5日間",
                sunTab: "太陽",
                uvTab: "UV",
                sunrise: "日の出",
                sunset: "日没",
                daylight: "日照時間",
                moonPhase: "月相",
                locationText: "位置情報取得中...",
                locationFound: "あなたは{city}にいます",
                locationError: "位置情報が利用できません",
                uvLabels: {
                    low: "弱い",
                    moderate: "中程度",
                    high: "強い",
                    veryHigh: "非常に強い",
                    extreme: "極端に強い"
                },
                uvGuide: {
                    "0-2": "弱い",
                    "3-5": "中程度",
                    "6-7": "強い",
                    "8-10": "非常に強い",
                    "11+": "極端に強い"
                }
            },
            ar: {
                appTitle: "SpayWeather",
                searchPlaceholder: "ابحث عن مدينة...",
                loading: "جار التحميل...",
                hourlyTab: "التنبؤ",
                dailyTab: "5 أيام",
                sunTab: "الشمس",
                uvTab: "الأشعة فوق البنفسجية",
                sunrise: "شروق الشمس",
                sunset: "غروب الشمس",
                daylight: "مدة النهار",
                moonPhase: "طور القمر",
                locationText: "جاري تحديد الموقع...",
                locationFound: "أنت في {city}",
                locationError: "الموقع غير متاح",
                uvLabels: {
                    low: "منخفض",
                    moderate: "متوسط",
                    high: "مرتفع",
                    veryHigh: "مرتفع جداً",
                    extreme: "شديد"
                },
                uvGuide: {
                    "0-2": "منخفض",
                    "3-5": "متوسط",
                    "6-7": "مرتفع",
                    "8-10": "مرتفع جداً",
                    "11+": "شديد"
                }
            }
        };

        // Données de prévision
        let forecastData = [];
        let currentLanguage = 'fr';
        let userLocation = null;
        let currentWeatherData = null;
        let refreshInterval = null;
        let forecastRefreshInterval = null;

        // Initialisation
        function init() {
            // Détecter la langue du navigateur
            const browserLang = navigator.language || navigator.userLanguage;
            currentLanguage = browserLang.split('-')[0];
            if (!translations[currentLanguage]) {
                currentLanguage = 'fr'; // Fallback to French
            }

            // Événements
            elements.searchBtn.addEventListener('click', searchWeather);
            elements.cityInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') searchWeather();
            });
            elements.musicToggle.addEventListener('click', toggleMusic);
            elements.languageSelect.addEventListener('change', changeLanguage);
            elements.hourlyTab.addEventListener('click', () => switchTab('hourly'));
            elements.dailyTab.addEventListener('click', () => switchTab('daily'));
            elements.sunTab.addEventListener('click', () => switchTab('sun'));
            elements.uvTab.addEventListener('click', () => switchTab('uv'));

            // Mettre à jour la langue dans le sélecteur
            elements.languageSelect.value = currentLanguage;

            // Traduire l'interface
            translateUI();

            // Obtenir la localisation de l'utilisateur
            getUserLocation();

            // Contourner la restriction d'autoplay
            document.body.addEventListener('click', () => {
                elements.bgMusic.play().catch(e => console.log("Musique:", e));
                elements.videoBg.play().catch(e => console.log("Vidéo:", e));
            }, { once: true });
        }

        // Changer d'onglet
        function switchTab(tab) {
            // Désactiver tous les onglets
            elements.hourlyTab.classList.remove('active');
            elements.dailyTab.classList.remove('active');
            elements.sunTab.classList.remove('active');
            elements.uvTab.classList.remove('active');

            // Masquer tous les contenus
            elements.hourlyContent.style.display = 'none';
            elements.dailyForecast.style.display = 'none';
            elements.sunInfo.classList.remove('active');
            elements.uvInfo.classList.remove('active');

            // Activer l'onglet sélectionné
            if (tab === 'hourly') {
                elements.hourlyTab.classList.add('active');
                elements.hourlyContent.style.display = 'block';
            } else if (tab === 'daily') {
                elements.dailyTab.classList.add('active');
                elements.dailyForecast.style.display = 'flex';
            } else if (tab === 'sun') {
                elements.sunTab.classList.add('active');
                elements.sunInfo.classList.add('active');
                updateSunInfo();
            } else if (tab === 'uv') {
                elements.uvTab.classList.add('active');
                elements.uvInfo.classList.add('active');
                updateUVInfo();
            }
        }

        // Changer la langue
        function changeLanguage() {
            currentLanguage = elements.languageSelect.value;
            translateUI();

            // Si on a déjà des données météo, on les recharge avec la nouvelle langue
            if (userLocation) {
                getWeatherData(userLocation);
            } else if (elements.cityName.textContent !== translations[currentLanguage].loading) {
                getWeatherData(elements.cityName.textContent.split(',')[0]);
            }
        }

        // Traduire l'interface
        function translateUI() {
            const lang = translations[currentLanguage];

            // Titres et textes
            elements.appTitle.textContent = lang.appTitle;
            elements.cityInput.placeholder = lang.searchPlaceholder;
            elements.hourlyTab.innerHTML = `<i class="fas fa-clock"></i> ${lang.hourlyTab}`;
            elements.dailyTab.innerHTML = `<i class="fas fa-calendar-day"></i> ${lang.dailyTab}`;
            elements.sunTab.innerHTML = `<i class="fas fa-sun"></i> ${lang.sunTab}`;
            elements.uvTab.innerHTML = `<i class="fas fa-sun"></i> ${lang.uvTab}`;

            // Si le texte actuel correspond à une traduction, on le met à jour
            if (elements.cityName.textContent === translations['fr'].loading) {
                elements.cityName.textContent = lang.loading;
            }

            if (elements.locationText.textContent === translations['fr'].locationText) {
                elements.locationText.textContent = lang.locationText;
            }

            // Mettre à jour les labels UV
            if (elements.uvInfo) {
                const uvRows = elements.uvInfo.querySelectorAll('.detail-row');
                uvRows[0].innerHTML = `<span>0-2</span><span>${lang.uvGuide["0-2"]}</span>`;
                uvRows[1].innerHTML = `<span>3-5</span><span>${lang.uvGuide["3-5"]}</span>`;
                uvRows[2].innerHTML = `<span>6-7</span><span>${lang.uvGuide["6-7"]}</span>`;
                uvRows[3].innerHTML = `<span>8-10</span><span>${lang.uvGuide["8-10"]}</span>`;
                uvRows[4].innerHTML = `<span>11+</span><span>${lang.uvGuide["11+"]}</span>`;
            }
        }

        // Obtenir la localisation de l'utilisateur
        function getUserLocation() {
            if (navigator.geolocation) {
                elements.locationText.textContent = translations[currentLanguage].locationText;

                navigator.geolocation.getCurrentPosition(
                    position => {
                        // Récupérer la ville à partir des coordonnées
                        getCityFromCoords(position.coords.latitude, position.coords.longitude);
                    },
                    error => {
                        console.error("Erreur de géolocalisation:", error);
                        elements.locationText.textContent = translations[currentLanguage].locationError;
                        // Démarrer avec Paris par défaut si la géolocalisation échoue
                        getWeatherData('Paris');
                    }
                );
            } else {
                elements.locationText.textContent = translations[currentLanguage].locationError;
                // Démarrer avec Paris par défaut si la géolocalisation n'est pas supportée
                getWeatherData('Paris');
            }
        }

        // Obtenir le nom de la ville à partir des coordonnées
        async function getCityFromCoords(lat, lon) {
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${WEATHER_API_KEY}`
                );

                if (!response.ok) throw new Error('Ville non trouvée');

                const data = await response.json();
                userLocation = data.name;
                elements.locationText.textContent = translations[currentLanguage].locationFound.replace('{city}', data.name);
                getWeatherData(data.name);
            } catch (error) {
                console.error('Erreur:', error);
                elements.locationText.textContent = translations[currentLanguage].locationError;
                // Démarrer avec Paris par défaut si on ne peut pas obtenir la ville
                getWeatherData('Paris');
            }
        }

        // Recherche météo
        function searchWeather() {
            const city = elements.cityInput.value.trim();
            if (city) {
                userLocation = city;
                getWeatherData(city);
            }
        }

        // Obtenir les données météo
        async function getWeatherData(city) {
            try {
                elements.cityName.textContent = translations[currentLanguage].loading;

                // Effacer les intervalles précédents
                if (refreshInterval) clearInterval(refreshInterval);
                if (forecastRefreshInterval) clearInterval(forecastRefreshInterval);

                // Météo actuelle
                const currentResponse = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?q=${city}&units=metric&appid=${WEATHER_API_KEY}&lang=${currentLanguage}`
                );

                if (!currentResponse.ok) throw new Error(translations[currentLanguage].locationError);

                const currentData = await currentResponse.json();
                currentWeatherData = currentData;
                updateWeatherUI(currentData);

                // Prévisions sur 5 jours
                const forecastResponse = await fetch(
                    `https://api.openweathermap.org/data/2.5/forecast?q=${city}&units=metric&appid=${WEATHER_API_KEY}&lang=${currentLanguage}`
                );

                const forecastDataResponse = await forecastResponse.json();
                updateHourlyForecast(forecastDataResponse.list);
                updateDailyForecast(forecastDataResponse.list);
                updateSunInfo();
                updateUVInfo();

                // Actualiser la température toutes les 1 minute
                refreshInterval = setInterval(() => {
                    updateWeatherUI(currentWeatherData);
                }, 60000); // 1 minute

                // Actualiser les prévisions toutes les 3 heures
                forecastRefreshInterval = setInterval(async () => {
                    const forecastResponse = await fetch(
                        `https://api.openweathermap.org/data/2.5/forecast?q=${city}&units=metric&appid=${WEATHER_API_KEY}&lang=${currentLanguage}`
                    );
                    const forecastDataResponse = await forecastResponse.json();
                    updateHourlyForecast(forecastDataResponse.list);
                    updateDailyForecast(forecastDataResponse.list);
                }, 10800000); // 3 heures

            } catch (error) {
                alert(error.message);
                console.error('Erreur:', error);
            }
        }

        // Mettre à jour les prévisions horaires avec les heures spécifiques
        function updateHourlyForecast(forecastList) {
            elements.hourlyForecast.innerHTML = '';

            // Heures spécifiques à afficher (dans l'ordre souhaité, sans répétition)
            const targetHours = [2, 5, 8, 10, 14, 17];

            // Filtrer pour les heures spécifiques seulement
            const hourlyData = forecastList
                .filter(item => {
                    const hour = new Date(item.dt * 1000).getHours();
                    return targetHours.includes(hour);
                })
                .sort((a, b) => targetHours.indexOf(new Date(a.dt * 1000).getHours()) - targetHours.indexOf(new Date(b.dt * 1000).getHours()));

            if (hourlyData.length === 0) return;

            hourlyData.forEach(item => {
                const date = new Date(item.dt * 1000);
                const hour = date.getHours();
                const temp = item.main.temp;
                const icon = item.weather[0].icon;

                // Ajouter l'élément horaire
                const hourElement = document.createElement('div');
                hourElement.className = 'hour-item';
                hourElement.innerHTML = `
                    <div class="hour-time">${hour}h</div>
                    <div class="hour-icon"><i class="fas ${weatherIcons[icon] || 'fa-question'}"></i></div>
                    <div class="hour-temp">${Math.round(temp)}°</div>
                `;
                elements.hourlyForecast.appendChild(hourElement);
            });
        }

        // Mettre à jour les prévisions sur 5 jours
        function updateDailyForecast(forecastList) {
            elements.dailyForecast.innerHTML = '';

            // Grouper par jour
            const dailyForecasts = {};

            forecastList.forEach(item => {
                const date = new Date(item.dt * 1000);
                const dayKey = date.toLocaleDateString();

                if (!dailyForecasts[dayKey]) {
                    dailyForecasts[dayKey] = [];
                }

                dailyForecasts[dayKey].push(item);
            });

            // Prendre les 5 prochains jours (aujourd'hui + 4 jours suivants)
            const next5Days = Object.keys(dailyForecasts).slice(0, 5);

            next5Days.forEach(dayKey => {
                const dayForecasts = dailyForecasts[dayKey];
                const date = new Date(dayForecasts[0].dt * 1000);

                // Calculer la température moyenne et trouver l'icône la plus représentative
                let totalTemp = 0;
                let iconCounts = {};

                dayForecasts.forEach(forecast => {
                    totalTemp += forecast.main.temp;

                    const icon = forecast.weather[0].icon;
                    iconCounts[icon] = (iconCounts[icon] || 0) + 1;
                });

                const avgTemp = Math.round(totalTemp / dayForecasts.length);

                // Trouver l'icône la plus fréquente
                let mostFrequentIcon = Object.keys(iconCounts).reduce((a, b) =>
                    iconCounts[a] > iconCounts[b] ? a : b
                );

                // Créer l'élément du jour
                const dayElement = document.createElement('div');
                dayElement.className = 'day-item';
                dayElement.dataset.date = dayKey; // Ajouter la date comme attribut de données

                // Formater la date (ex: "Lun 1/7")
                const dayName = weekDays[date.getDay()];
                const dayNumber = date.getDate();
                const monthNumber = date.getMonth() + 1; // Les mois commencent à 0

                dayElement.innerHTML = `
                    <div class="day-name">${dayName}</div>
                    <div class="day-date">${dayNumber}/${monthNumber}</div>
                    <div class="day-icon"><i class="fas ${weatherIcons[mostFrequentIcon] || 'fa-question'}"></i></div>
                    <div class="day-temp">${avgTemp}°</div>
                `;

                // Ajouter un gestionnaire d'événements pour détecter les clics
                dayElement.addEventListener('click', () => {
                    updateHourlyForecastForDay(dayForecasts);
                });

                elements.dailyForecast.appendChild(dayElement);
            });
        }

        // Mettre à jour les prévisions horaires pour un jour spécifique
        function updateHourlyForecastForDay(dayForecasts) {
            elements.hourlyForecast.innerHTML = '';

            // Heures spécifiques à afficher (dans l'ordre souhaité, sans répétition)
            const targetHours = [2, 5, 8, 10, 14, 17];

            // Filtrer pour les heures spécifiques seulement
            const hourlyData = dayForecasts
                .filter(item => {
                    const hour = new Date(item.dt * 1000).getHours();
                    return targetHours.includes(hour);
                })
                .sort((a, b) => targetHours.indexOf(new Date(a.dt * 1000).getHours()) - targetHours.indexOf(new Date(b.dt * 1000).getHours()));

            if (hourlyData.length === 0) return;

            hourlyData.forEach(item => {
                const date = new Date(item.dt * 1000);
                const hour = date.getHours();
                const temp = item.main.temp;
                const icon = item.weather[0].icon;

                // Ajouter l'élément horaire
                const hourElement = document.createElement('div');
                hourElement.className = 'hour-item';
                hourElement.innerHTML = `
                    <div class="hour-time">${hour}h</div>
                    <div class="hour-icon"><i class="fas ${weatherIcons[icon] || 'fa-question'}"></i></div>
                    <div class="hour-temp">${Math.round(temp)}°</div>
                `;
                elements.hourlyForecast.appendChild(hourElement);
            });
        }

        // Mettre à jour les infos soleil/lune
        function updateSunInfo() {
            if (!currentWeatherData) return;

            const lang = translations[currentLanguage];

            // Heures de lever/coucher du soleil
            const sunrise = new Date(currentWeatherData.sys.sunrise * 1000);
            const sunset = new Date(currentWeatherData.sys.sunset * 1000);

            elements.sunriseValue.textContent = sunrise.toLocaleTimeString(currentLanguage, { hour: '2-digit', minute: '2-digit' });
            elements.sunsetValue.textContent = sunset.toLocaleTimeString(currentLanguage, { hour: '2-digit', minute: '2-digit' });

            // Durée du jour
            const daylightMs = sunset - sunrise;
            const daylightHours = Math.floor(daylightMs / (1000 * 60 * 60));
            const daylightMinutes = Math.floor((daylightMs % (1000 * 60 * 60)) / (1000 * 60));
            elements.daylightValue.textContent = `${daylightHours}h ${daylightMinutes}m`;

            // Phase lunaire (simulée)
            const moonAge = (Date.now() / (1000 * 60 * 60 * 24) + 9) % 29.53; // Age lunaire en jours
            const moonPhaseIndex = Math.floor((moonAge / 29.53) * 8) % 8;
            elements.moonPhase.textContent = moonPhases[moonPhaseIndex];
        }

        // Mettre à jour les infos UV
        function updateUVInfo() {
            if (!currentWeatherData) return;

            const lang = translations[currentLanguage];

            // Simuler un indice UV basé sur l'heure et la météo
            const now = new Date();
            const hour = now.getHours();
            const isDaytime = hour >= 6 && hour <= 18;
            const weather = currentWeatherData.weather[0].main.toLowerCase();

            let uvValue;
            let uvClass = 'uv-low';
            let uvLabel = lang.uvLabels.low;

            // Logique simplifiée pour déterminer l'UV
            if (weather.includes('clear') && isDaytime) {
                // Ensoleillé en journée = UV élevé
                if (hour >= 10 && hour <= 14) {
                    // Heures de fort ensoleillement
                    uvValue = Math.floor(Math.random() * 3) + 8; // 8-10
                    uvClass = 'uv-very-high';
                    uvLabel = lang.uvLabels.veryHigh;
                } else {
                    // Autres heures ensoleillées
                    uvValue = Math.floor(Math.random() * 3) + 5; // 5-7
                    uvClass = 'uv-high';
                    uvLabel = lang.uvLabels.high;
                }
            } else if (weather.includes('cloud') && isDaytime) {
                // Nuageux en journée = UV modéré
                uvValue = Math.floor(Math.random() * 3) + 3; // 3-5
                uvClass = 'uv-moderate';
                uvLabel = lang.uvLabels.moderate;
            } else if (isDaytime) {
                // Autres conditions de jour
                uvValue = Math.floor(Math.random() * 3) + 2; // 2-4
                uvClass = 'uv-low';
                uvLabel = lang.uvLabels.low;
            } else {
                // Nuit = pas d'UV
                uvValue = 0;
                uvClass = 'uv-low';
                uvLabel = lang.uvLabels.low;
            }

            // Mettre à jour l'interface
            elements.uvIndex.textContent = uvValue;
            elements.uvValue.textContent = uvValue;
            elements.uvValue.className = `uv-value ${uvClass}`;
            elements.uvLabel.textContent = uvLabel;
        }

        // Mettre à jour l'interface
        function updateWeatherUI(data) {
            elements.cityName.textContent = `${data.name}, ${data.sys.country}`;
            elements.temp.textContent = Math.round(data.main.temp);
            elements.weatherDesc.textContent = data.weather[0].description;
            elements.humidity.textContent = `${data.main.humidity}%`;
            elements.feelsLike.textContent = `${Math.round(data.main.feels_like)}°C`;
            elements.visibility.textContent = `${(data.visibility / 1000).toFixed(1)} km`;

            // Mettre à jour l'icône
            const iconCode = data.weather[0].icon;
            elements.weatherIcon.className = `fas ${weatherIcons[iconCode] || 'fa-question'}`;

            // Mettre à jour l'indice UV
            updateUVInfo();
        }

        // Contrôle musique
        function toggleMusic() {
            if (elements.bgMusic.paused) {
                elements.bgMusic.play();
                elements.musicToggle.innerHTML = '<i class="fas fa-volume-up"></i>';
            } else {
                elements.bgMusic.pause();
                elements.musicToggle.innerHTML = '<i class="fas fa-volume-mute"></i>';
            }
        }

        // Démarrer l'application
        init();
    </script>
</body>
</html>
